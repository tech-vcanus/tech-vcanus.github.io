I"Q<p>Written By <a href="https://github.com/nurring">Nuri Na</a>, VCANUS</p>

<h2 id="about">About</h2>

<ul>
  <li>
    <p>JVM: ElasticsearchëŠ” ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ Java ì„¤ì¹˜ í•„ìš”</p>
  </li>
  <li>
    <p>HTTP / RESTful API: REST APIë¥¼ í†µí•´ ì¡°ì‘</p>
  </li>
  <li>
    <p>JSON: ë‚´ë¶€ì— JSONìœ¼ë¡œ ì €ì¥, ìš”ì²­/ì‘ë‹µë„ JSON í˜•ì‹</p>
  </li>
  <li>
    <p>ì—­ìƒ‰ì¸(Inverted Index) êµ¬ì¡°: ë‹¨ì–´ ê²€ìƒ‰ ì‹œ í•´ë‹¹ ë‹¨ì–´ê°€ í¬í•¨ëœ ëª¨ë“  documentë¥¼ ê°€ë¦¬í‚´</p>
  </li>
  <li>
    <p>Index/type/document : ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ì˜ ë°ì´í„° ê³„ì¸µ.  <code class="highlighter-rouge">/&lt;indexName&gt;/&lt;typeName&gt;/&lt;documentName&gt;</code> ë¡œ í‘œí˜„ <br />
í˜„ì¬ëŠ” typeë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šë„ë¡ í•˜ê³  ìˆìœ¼ë©°, /indexName/<code class="highlighter-rouge">_doc</code>/documentNameìœ¼ë¡œ ì‚¬ìš©</p>
  </li>
</ul>

<h2 id="indexing">Indexing</h2>

<p>ì¸ë±ìŠ¤ ìƒì„±</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//**Example**</span>
<span class="n">PUT</span> <span class="n">lecture</span> <span class="c1">// lecture ì¸ë±ìŠ¤ ìƒì„±</span>

<span class="n">PUT</span> <span class="n">lecture</span><span class="o">/</span><span class="n">_doc</span><span class="o">/</span><span class="mi">1</span> <span class="c1">// ì¸ë±ìŠ¤ê°€ ì—†ì„ ê²½ìš° ì¸ë±ìŠ¤ ìƒì„±, title í•„ë“œì— value ì €ì¥ (Schemeless)</span>
<span class="p">{</span>
  <span class="s">"title"</span><span class="o">:</span> <span class="s">"ê·¼ëŒ€ ì¤‘êµ­ì‚¬"</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="mapping">Mapping</h2>

<p>ì¸ë±ìŠ¤ì— í•„ë“œì™€ ë°ì´í„° í¬ë§·ì„ ì •ì˜</p>

<p>ê°€ëŠ¥í•œ ë°ì´í„° íƒ€ì…ì€ text, keyword, date, long, double, boolean, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/ip.html">ip</a>, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-point.html">geo_point</a> ë“±</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//**Example**</span>
<span class="n">PUT</span> <span class="n">lecture</span><span class="o">/</span><span class="n">_mapping</span>
<span class="p">{</span>
  <span class="s">"properties"</span><span class="o">:</span><span class="p">{</span>
    <span class="s">"title"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"text"</span><span class="p">},</span>
    <span class="s">"professor"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"text"</span><span class="p">},</span>
    <span class="s">"major"</span><span class="o">:</span><span class="p">{</span> <span class="c1">//textì™€ keyword ë‘ ê°€ì§€ë¡œ ì •ì˜</span>
      <span class="s">"type"</span><span class="o">:</span><span class="s">"text"</span><span class="p">,</span>
      <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"raw"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"type"</span><span class="o">:</span><span class="s">"keyword"</span> <span class="c1">//fields.raw</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">"semester"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"text"</span><span class="p">},</span>
    <span class="s">"student_count"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"integer"</span><span class="p">},</span>
    <span class="s">"unit"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"integer"</span><span class="p">},</span>
    <span class="s">"rating"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"integer"</span><span class="p">},</span>
    <span class="s">"report_due_date"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"date"</span><span class="p">,</span><span class="s">"format"</span><span class="o">:</span><span class="s">"yyyy-MM-dd"</span><span class="p">},</span>
    <span class="s">"school_location"</span><span class="o">:</span><span class="p">{</span><span class="s">"type"</span><span class="o">:</span><span class="s">"geo_point"</span><span class="p">}</span> <span class="c1">//ì¢Œí‘œê°’. lat/lon í‚¤ë¥¼ ê°€ì§. geohash ê°€ëŠ¥. </span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="insertupdate">Insert/Update</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//**Example**</span>
<span class="n">PUT</span> <span class="n">lecture</span><span class="o">/</span><span class="n">_doc</span><span class="o">/</span><span class="mi">1</span>
<span class="p">{</span>
  <span class="s">"title"</span><span class="o">:</span> <span class="s">"ì¤‘êµ­ ê³ ì „ ê°•ë…"</span><span class="p">,</span>
  <span class="s">"professor"</span><span class="o">:</span> <span class="s">"ë‚˜ë¯¼êµ¬"</span><span class="p">,</span>
  <span class="s">"major"</span><span class="o">:</span> <span class="s">"ì¤‘êµ­ì–´"</span><span class="p">,</span> <span class="c1">// textì™€ keyword ë‘ ê°€ì§€ íƒ€ì…ìœ¼ë¡œ mapping</span>
  <span class="s">"semester"</span><span class="o">:</span> <span class="s">"1í•™ê¸°"</span><span class="p">,</span>
  <span class="s">"student_count"</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="s">"unit"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="s">"rating"</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
  <span class="s">"report_due_date"</span><span class="o">:</span> <span class="s">"2020-03-10"</span><span class="p">,</span>
  <span class="s">"school_location"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">"lat"</span><span class="o">:</span><span class="mi">37</span><span class="p">.</span><span class="mi">401376</span><span class="p">,</span>
    <span class="s">"lon"</span><span class="o">:</span><span class="mi">127</span><span class="p">.</span><span class="mi">110516</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">PUT</span> <span class="n">lecture</span><span class="o">/</span><span class="n">_doc</span><span class="o">/</span><span class="mi">2</span>
<span class="p">{</span>
  <span class="s">"title"</span><span class="o">:</span> <span class="s">"í˜„ëŒ€ì¤‘êµ­ì •ì¹˜"</span><span class="p">,</span>
  <span class="s">"professor"</span><span class="o">:</span> <span class="s">"ì˜¤ìŠ¹ë ¬"</span><span class="p">,</span>
  <span class="s">"major"</span><span class="o">:</span> <span class="s">"ì¤‘êµ­ì–´"</span><span class="p">,</span>
  <span class="s">"semester"</span><span class="o">:</span> <span class="s">"1í•™ê¸°"</span><span class="p">,</span>
  <span class="s">"student_count"</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s">"unit"</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="s">"rating"</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s">"report_due_date"</span><span class="o">:</span> <span class="s">"2020-03-24"</span><span class="p">,</span>
  <span class="s">"school_location"</span><span class="o">:</span> <span class="s">"drm3btev3e86"</span> <span class="c1">//geohash</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="uri-search">URI Search</h2>

<p>URLì— íŒŒë¼ë¯¸í„°ë¥¼ ë„˜ê²¨ ë¬¸ì„œ ì¡°íšŒ, ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ì— ìœ ìš©</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## Example</span>
curl <span class="nt">-XGET</span> <span class="s1">'localhost:9200/&lt;indexName&gt;/_search?q=&lt;ê²€ìƒ‰ì–´&gt;&amp;sort=&lt;ì •ë ¬ê¸°ì¤€&gt;'</span>
</code></pre></div></div>

<h2 id="query-dsl">Query DSL</h2>

<p>Request Body ê²€ìƒ‰ì— ì´ìš©ë˜ëŠ” JSON êµ¬ì¡°ë¥¼ ì§€ì›, ë‹¤ì–‘í•œ ê²€ìƒ‰ ì¡°ê±´ ì¡°í•©ì— ìš©ì´í•˜ë©° ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•´ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë¨</p>

<h4 id="query-dsl-êµ¬ì¡°">Query DSL êµ¬ì¡°</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="s">"size"</span><span class="o">:</span> <span class="c1">//ë¦¬í„´ ê²°ê³¼ ê°œìˆ˜ ì§€ì •</span>
  <span class="s">"from"</span><span class="o">:</span> <span class="c1">//ëª‡ ë²ˆì§¸ ë¬¸ì„œë¶€í„° ê°€ì ¸ì˜¬ ì§€ ì§€ì •</span>
  <span class="s">"timeout"</span><span class="o">:</span> <span class="c1">//ê²°ê³¼ ë°›ëŠ” ë°ê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„</span>
  
  <span class="s">"_source"</span><span class="o">:</span> <span class="c1">//íŠ¹ì • í•„ë“œë§Œ ì¶œë ¥í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©</span>
  <span class="s">"query"</span> <span class="o">:</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">//ê²€ìƒ‰ ì¡°ê±´ë¬¸ ì‘ì„±</span>
  <span class="s">"aggs"</span> <span class="o">:</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">//í†µê³„ ë° ì§‘ê³„</span>
  <span class="s">"sort"</span> <span class="o">:</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">//ì¶œë ¥ ì¡°ê±´</span>
<span class="p">}</span>
</code></pre></div></div>

<p>â€‹</p>

<p><em>* ì˜ˆì‹œë¥¼ í†µí•´ í™•ì¸í•  ê²ƒ</em></p>

<ol>
  <li>
    <p>must ì—°ì‚°ê³¼ ì¡°ê±´ ì¿¼ë¦¬</p>

    <table>
      <thead>
        <tr>
          <th>Elasticsearch</th>
          <th>SQL</th>
          <th>ì„¤ëª…</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>must : [field]</td>
          <td>AND <column> = <ì¡°ê±´></ì¡°ê±´></column></td>
          <td>ë°˜ë“œì‹œ ì¡°ê±´ì— ë§Œì¡±í•˜ëŠ” ë¬¸ì„œë§Œ</td>
        </tr>
        <tr>
          <td>must_not : [field]</td>
          <td>AND <column> != <ì¡°ê±´></ì¡°ê±´></column></td>
          <td>ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠëŠ” ë¬¸ì„œ</td>
        </tr>
        <tr>
          <td>should : [field]</td>
          <td>OR <column> = <ì¡°ê±´></ì¡°ê±´></column></td>
          <td>ì—¬ëŸ¬ ì¡°ê±´ ì¤‘ í•˜ë‚˜ ì´ìƒ ë§Œì¡±í•˜ëŠ” ë¬¸ì„œ</td>
        </tr>
        <tr>
          <td>filter : [field]</td>
          <td><column> IN <ì¡°ê±´></ì¡°ê±´></column></td>
          <td>ì¡°ê±´ì„ í¬í•¨í•˜ëŠ” ë¬¸ì„œ</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>ì¿¼ë¦¬ ì»¨í…ìŠ¤íŠ¸ì™€ í•„í„° ì»¨í…ìŠ¤íŠ¸</p>
  </li>
  <li>
    <p>match ì—°ì‚°</p>
  </li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//**Example**</span>

<span class="c1">// SELECT title FROM ( SELECT * FROM lecture WHERE major = 'ì¤‘êµ­ì–´' )</span>
<span class="c1">// WHERE title = '%í˜„ëŒ€%' OR title = '%ì¤‘êµ­%';</span>
<span class="n">POST</span> <span class="n">lecture</span><span class="o">/</span><span class="n">_search</span>
<span class="p">{</span>
  <span class="s">"from"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">//ì²« í˜ì´ì§€ë¶€í„°</span>
  <span class="s">"size"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c1">//5ê°œ ë¬¸ì„œë§Œ ì¡°íšŒ</span>
  <span class="s">"query"</span><span class="o">:</span> <span class="p">{</span> <span class="c1">//**ì¿¼ë¦¬ ì»¨í…ìŠ¤íŠ¸ - ì „ë¬¸ ê²€ìƒ‰. ì—°ê´€ì„± scoreë¥¼ ê³„ì‚°í•˜ì—¬ ê²°ê³¼ ë„ì¶œ. í•„í„°ë§ì„ ë¨¼ì € ê±°ì³ query ì¡°ê±´ì´ 2ê°œì¸ ê²½ìš°ë³´ë‹¤ ë¹¨ë¼ì§</span>
    <span class="s">"bool"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"must"</span><span class="o">:</span> <span class="p">[</span> <span class="c1">// ë°˜ë“œì‹œ ì¡°ê±´ì— ë§Œì¡±í•˜ëŠ” ë¬¸ì„œë§Œ ê²€ìƒ‰</span>
        <span class="p">{</span>
          <span class="s">"match"</span><span class="o">:</span> <span class="p">{</span>  <span class="c1">//'match' - í˜•íƒœì†Œ ë¶„ì„ì„ í†µí•´ í˜„ëŒ€/ì¤‘êµ­ 2ê°œ í…€ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ 'or' ì—°ì‚°í•¨</span>
            <span class="s">"title"</span><span class="o">:</span> <span class="s">"í˜„ëŒ€ ì¤‘êµ­"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s">"filter"</span><span class="o">:</span> <span class="p">{</span> <span class="c1">//**í•„í„° ì»¨í…ìŠ¤íŠ¸ - Y/N ë‹¨ìˆœ íŒë³„ë¡œ ì¿¼ë¦¬ ì»¨í…ìŠ¤íŠ¸ë³´ë‹¤ ë¹ ë¦„</span>
        <span class="s">"term"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"major"</span><span class="o">:</span> <span class="s">"ì¤‘êµ­ì–´"</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">"_source"</span><span class="o">:</span> <span class="p">[</span> <span class="s">"title"</span><span class="p">,</span> <span class="s">"rating"</span> <span class="p">],</span>  <span class="c1">//ë³´ê³  ì‹¶ì€ í•„ë“œë§Œ í•„í„°ë§</span>
  <span class="s">"sort"</span><span class="o">:</span> <span class="p">[</span> <span class="c1">//ì •ë ¬</span>
    <span class="p">{</span> 
      <span class="s">"rating"</span><span class="o">:</span> <span class="p">{</span> <span class="s">"order"</span><span class="o">:</span> <span class="s">"asc"</span> <span class="p">}</span> 
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="aggregationsì§‘ê³„">Aggregations(ì§‘ê³„)</h2>

<p>SQLë³´ë‹¤ ê°•ë ¥í•œ ì§‘ê³„ ê¸°ëŠ¥ ì œê³µ - ì—¬ëŸ¬ aggs ì¤‘ì²©, ë‚ ì§œ/ìœ„ì¹˜ ì •ë³´ ì§‘ê³„, ë¶„ì‚°ì²˜ë¦¬ ë“±</p>

<p>ì§‘ê³„ ì‹œ ë¬¸ì„œë¥¼ í‰ê°€í•œ í›„ ê¸°ì¤€ì— ë§Œì¡±í•˜ëŠ” ë¬¸ì„œë¥¼ ê·¸ë£¹í™” í•˜ê³ , ê·¸ê²ƒì„ í† ëŒ€ë¡œ ì§‘ê³„ë¥¼ ìˆ˜í–‰</p>

<h4 id="ì§‘ê³„-êµ¬ë¬¸-êµ¬ì¡°">ì§‘ê³„ êµ¬ë¬¸ êµ¬ì¡°</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="s">"query"</span><span class="o">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>
  <span class="s">"aggregations"</span> <span class="o">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="c1">//í˜¹ì€ aggs</span>
<span class="p">}</span>

<span class="s">"aggregations"</span><span class="o">:</span> <span class="p">{</span>
  <span class="s">"ì§‘ê³„ ì´ë¦„"</span><span class="o">:</span><span class="p">{</span>
    <span class="s">"ì§‘ê³„ íƒ€ì…"</span><span class="o">:</span><span class="p">{</span> <span class="c1">//terms, date_histogram, sum ...</span>
      <span class="err">ì§‘ê³„</span> <span class="err">íƒ€ì…ì—</span> <span class="err">ë§ëŠ”</span> <span class="err">ì¡°ê±´</span> <span class="err">ë‚´ìš©</span>
    <span class="p">},</span>
    <span class="p">[,</span> <span class="s">"meta"</span> <span class="o">:</span> <span class="p">{</span> <span class="err">ë©”íƒ€</span> <span class="err">ë°ì´í„°</span> <span class="err">ì¡°ê±´</span> <span class="err">ë‚´ìš©</span> <span class="p">}]</span><span class="o">?</span> <span class="c1">//ë©”íƒ€ í•„ë“œ ê°€ëŠ¥</span>
    <span class="p">[,</span> <span class="s">"aggregations"</span> <span class="o">:</span> <span class="p">{</span> <span class="p">[</span> <span class="err">ì„œë¸Œ</span> <span class="err">ì§‘ê³„</span> <span class="p">]</span><span class="o">+</span> <span class="p">}</span> <span class="p">]</span><span class="o">?</span> <span class="c1">//ì„œë¸Œ ì§‘ê³„ ê°€ëŠ¥</span>
  <span class="p">}</span>
  <span class="p">[,</span><span class="s">"ì§‘ê³„ ì´ë¦„2"</span> <span class="o">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}]</span><span class="o">*</span> <span class="c1">//ì§‘ê³„ ì¤‘ì²© ê°€ëŠ¥</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//**Example**</span>

<span class="c1">// í•™ìƒìˆ˜ ë²”ìœ„(group_by_student_count) ë³„ ê°•ì˜ í‰ì (average_rating)</span>
<span class="c1">// SELECT avg(rating) as average_rating FROM lecture GROUP BY í•™ìƒ ìˆ˜ ë²”ìœ„(..)</span>
<span class="n">POST</span> <span class="n">lecture</span><span class="o">/</span><span class="n">_search</span>
<span class="p">{</span>
  <span class="s">"size"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">//ì§€ì •í•œ fieldë§Œ ê²€ìƒ‰ ë¨</span>
  <span class="s">"aggs"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">"group_by_student_count"</span><span class="o">:</span> <span class="p">{</span> <span class="c1">//ê·¸ë£¹í™”</span>
      <span class="s">"range"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"field"</span><span class="o">:</span> <span class="s">"student_count"</span><span class="p">,</span>
        <span class="s">"ranges"</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span> <span class="s">"from"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">// ì´ìƒ (&lt;=)</span>
            <span class="s">"to"</span><span class="o">:</span> <span class="mi">11</span> <span class="p">},</span> <span class="c1">// ë¯¸ë§Œ (&lt;)</span>
          <span class="p">{</span> <span class="s">"from"</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span>
            <span class="s">"to"</span><span class="o">:</span> <span class="mi">21</span> <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="s">"aggs"</span><span class="o">:</span> <span class="p">{</span> <span class="c1">//ì§‘ê³„</span>
        <span class="s">"average_rating"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"avg"</span><span class="o">:</span> <span class="p">{</span> <span class="s">"field"</span><span class="o">:</span> <span class="s">"rating"</span>  <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// SELECT major, avg(rating) from  lecture GROUP BY major;</span>
<span class="n">GET</span> <span class="n">lecture</span><span class="o">/</span><span class="n">_search</span>
<span class="p">{</span>
  <span class="s">"size"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"aggs"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">"group_by_major"</span><span class="o">:</span><span class="p">{</span> <span class="c1">//ê·¸ë£¹í™”</span>
      <span class="s">"terms"</span><span class="o">:</span><span class="p">{</span>
        <span class="s">"field"</span><span class="o">:</span> <span class="s">"major.raw"</span><span class="p">,</span>
        <span class="s">"order"</span> <span class="o">:</span> <span class="p">{</span> <span class="s">"_key"</span> <span class="o">:</span> <span class="s">"asc"</span> <span class="p">}</span>
      <span class="p">},</span>
      <span class="s">"aggs"</span><span class="o">:</span> <span class="p">{</span> <span class="c1">//ì§‘ê³„</span>
        <span class="s">"average_rating"</span><span class="o">:</span><span class="p">{</span>
          <span class="s">"avg"</span><span class="o">:</span><span class="p">{</span> <span class="s">"field"</span><span class="o">:</span> <span class="s">"rating"</span> <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="shards--replicas">Shards &amp; Replicas</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PUT</span> <span class="n">lecture</span>
<span class="p">{</span>
  <span class="s">"settings"</span><span class="o">:</span><span class="p">{</span>
    <span class="s">"index"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"number_of_shards"</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s">"number_of_replicas"</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

:ET